//--------------------------//
// Hooking TranslateMessage //
//--------------------------//

// Native function pointers
//-----------------------
var pTranslateMessage = Module.findExportByName('user32.dll', 'TranslateMessage');
var pGetClassNameW = Module.findExportByName('user32.dll', 'GetClassNameW');

// Function prototypes
//-----------------------
var fGetClassNameW = new NativeFunction(
    pGetClassNameW,
    "int",
    [
        "pointer",
        "pointer", 
        "int"
    ]
);

// Enum
//-----------------------
var msgType = {
	WM_NULL : 0x0000,
	WM_CREATE : 0x0001,
	WM_DESTROY : 0x0002,
	WM_MOVE : 0x0003,
	WM_SIZEWAIT : 0x0004,
	WM_SIZE : 0x0005,
	WM_ACTIVATE : 0x0006,
	WM_SETFOCUS : 0x0007,
	WM_KILLFOCUS : 0x0008,
	WM_SETVISIBLE : 0x0009,
	WM_ENABLE : 0x000A,
	WM_SETREDRAW : 0x000B,
	WM_SETTEXT : 0x000C,
	WM_GETTEXT : 0x000D,
	WM_GETTEXTLENGTH : 0x000E,
	WM_PAINT : 0x000F,
	WM_CLOSE : 0x0010,
	WM_QUERYENDSESSION : 0x0011,
	WM_QUIT : 0x0012,
	WM_QUERYOPEN : 0x0013,
	WM_ERASEBKGND : 0x0014,
	WM_SYSCOLORCHANGE : 0x0015,
	WM_ENDSESSION : 0x0016,
	WM_SYSTEMERROR : 0x0017,
	WM_SHOWWINDOW : 0x0018,
	WM_CTLCOLOR : 0x0019,
	WM_SETTINGCHANGE : 0x001A,
	WM_DEVMODECHANGE : 0x001B,
	WM_ACTIVATEAPP : 0x001C,
	WM_FONTCHANGE : 0x001D,
	WM_TIMECHANGE : 0x001E,
	WM_CANCELMODE : 0x001F,
	WM_SETCURSOR : 0x0020,
	WM_MOUSEACTIVATE : 0x0021,
	WM_CHILDACTIVATE : 0x0022,
	WM_QUEUESYNC : 0x0023,
	WM_GETMINMAXINFO : 0x0024,
	WM_PAINTICON : 0x0026,
	WM_ICONERASEBKGND : 0x0027,
	WM_NEXTDLGCTL : 0x0028,
	WM_ALTTABACTIVE : 0x0029,
	WM_SPOOLERSTATUS : 0x002A,
	WM_DRAWITEM : 0x002B,
	WM_MEASUREITEM : 0x002C,
	WM_DELETEITEM : 0x002D,
	WM_VKEYTOITEM : 0x002E,
	WM_CHARTOITEM : 0x002F,
	WM_SETFONT : 0x0030,
	WM_GETFONT : 0x0031,
	WM_SETHOTKEY : 0x0032,
	WM_GETHOTKEY : 0x0033,
	WM_FILESYSCHANGE : 0x0034,
	WM_ISACTIVEICON : 0x0035,
	WM_QUERYPARKICON : 0x0036,
	WM_QUERYDRAGICON : 0x0037,
	WM_QUERYSAVESTATE : 0x0038,
	WM_COMPAREITEM : 0x0039,
	WM_TESTING : 0x003A,
	WM_GETOBJECT : 0x003D,
	WM_ACTIVATESHELLWINDOW : 0x003E,
	WM_COMPACTING : 0x0041,
	WM_COMMNOTIFY : 0x0044,
	WM_WINDOWPOSCHANGING : 0x0046,
	WM_WINDOWPOSCHANGED : 0x0047,
	WM_POWER : 0x0048,
	WM_COPYDATA : 0x004A,
	WM_CANCELJOURNAL : 0x004B,
	WM_NOTIFY : 0x004E,
	WM_INPUTLANGCHANGEREQUEST : 0x0050,
	WM_INPUTLANGCHANGE : 0x0051,
	WM_TCARD : 0x0052,
	WM_HELP : 0x0053,
	WM_USERCHANGED : 0x0054,
	WM_NOTIFYFORMAT : 0x0055,
	WM_CONTEXTMENU : 0x007B,
	WM_STYLECHANGING : 0x007C,
	WM_STYLECHANGED : 0x007D,
	WM_DISPLAYCHANGE : 0x007E,
	WM_GETICON : 0x007F,
	WM_SETICON : 0x0080,
	WM_NCCREATE : 0x0081,
	WM_NCDESTROY : 0x0082,
	WM_NCCALCSIZE : 0x0083,
	WM_NCHITTEST : 0x0084,
	WM_NCPAINT : 0x0085,
	WM_NCACTIVATE : 0x0086,
	WM_GETDLGCODE : 0x0087,
	WM_SYNCPAINT : 0x0088,
	WM_SYNCTASK : 0x0089,
	WM_NCMOUSEMOVE : 0x00A0,
	WM_NCLBUTTONDOWN : 0x00A1,
	WM_NCLBUTTONUP : 0x00A2,
	WM_NCLBUTTONDBLCLK : 0x00A3,
	WM_NCRBUTTONDOWN : 0x00A4,
	WM_NCRBUTTONUP : 0x00A5,
	WM_NCRBUTTONDBLCLK : 0x00A6,
	WM_NCMBUTTONDOWN : 0x00A7,
	WM_NCMBUTTONUP : 0x00A8,
	WM_NCMBUTTONDBLCLK : 0x00A9,
	WM_NCXBUTTONDOWN : 0x00AB,
	WM_NCXBUTTONUP : 0x00AC,
	WM_NCXBUTTONDBLCLK : 0x00AD,
	WM_INPUT_DEVICE_CHANGE : 0x00FE,
	WM_INPUT : 0x00FF,
	WM_KEYDOWN : 0x0100,
	WM_KEYUP : 0x0101,
	WM_CHAR : 0x0102,
	WM_DEADCHAR : 0x0103,
	WM_SYSKEYDOWN : 0x0104,
	WM_SYSKEYUP : 0x0105,
	WM_SYSCHAR : 0x0106,
	WM_SYSDEADCHAR : 0x0107,
	WM_UNICHAR : 0x0109,
	WM_IME_STARTCOMPOSITION : 0x010D,
	WM_IME_ENDCOMPOSITION : 0x010E,
	WM_IME_COMPOSITION : 0x010F,
	WM_INITDIALOG : 0x0110,
	WM_COMMAND : 0x0111,
	WM_SYSCOMMAND : 0x0112,
	WM_TIMER : 0x0113,
	WM_HSCROLL : 0x0114,
	WM_VSCROLL : 0x0115,
	WM_INITMENU : 0x0116,
	WM_INITMENUPOPUP : 0x0117,
	WM_SYSTIMER : 0x0118,
	WM_GESTURE : 0x0119,
	WM_GESTURENOTIFY : 0x011A,
	WM_MENUSELECT : 0x011F,
	WM_MENUCHAR : 0x0120,
	WM_ENTERIDLE : 0x0121,
	WM_MENURBUTTONUP : 0x0122,
	WM_MENUDRAG : 0x0123,
	WM_MENUGETOBJECT : 0x0124,
	WM_UNINITMENUPOPUP : 0x0125,
	WM_MENUCOMMAND : 0x0126,
	WM_CHANGEUISTATE : 0x0127,
	WM_UPDATEUISTATE : 0x0128,
	WM_QUERYUISTATE : 0x0129,
	WM_LBTRACKPOINT : 0x0131,
	WM_CTLCOLORMSGBOX : 0x0132,
	WM_CTLCOLOREDIT : 0x0133,
	WM_CTLCOLORLISTBOX : 0x0134,
	WM_CTLCOLORBTN : 0x0135,
	WM_CTLCOLORDLG : 0x0136,
	WM_CTLCOLORSCROLLBAR : 0x0137,
	WM_CTLCOLORSTATIC : 0x0138,
	MN_GETHMENU : 0x01E1,
	WM_MOUSEMOVE : 0x0200,
	WM_LBUTTONDOWN : 0x0201,
	WM_LBUTTONUP : 0x0202,
	WM_LBUTTONDBLCLK : 0x0203,
	WM_RBUTTONDOWN : 0x0204,
	WM_RBUTTONUP : 0x0205,
	WM_RBUTTONDBLCLK : 0x0206,
	WM_MBUTTONDOWN : 0x0207,
	WM_MBUTTONUP : 0x0208,
	WM_MBUTTONDBLCLK : 0x0209,
	WM_MOUSEWHEEL : 0x020A,
	WM_XBUTTONDOWN : 0x020B,
	WM_XBUTTONUP : 0x020C,
	WM_XBUTTONDBLCLK : 0x020D,
	WM_MOUSEHWHEEL : 0x020E,
	WM_PARENTNOTIFY : 0x0210,
	WM_ENTERMENULOOP : 0x0211,
	WM_EXITMENULOOP : 0x0212,
	WM_NEXTMENU : 0x0213,
	WM_SIZING : 0x0214,
	WM_CAPTURECHANGED : 0x0215,
	WM_MOVING : 0x0216,
	WM_POWERBROADCAST : 0x0218,
	WM_DEVICECHANGE : 0x0219,
	WM_MDICREATE : 0x0220,
	WM_MDIDESTROY : 0x0221,
	WM_MDIACTIVATE : 0x0222,
	WM_MDIRESTORE : 0x0223,
	WM_MDINEXT : 0x0224,
	WM_MDIMAXIMIZE : 0x0225,
	WM_MDITILE : 0x0226,
	WM_MDICASCADE : 0x0227,
	WM_MDIICONARRANGE : 0x0228,
	WM_MDIGETACTIVE : 0x0229,
	WM_DROPOBJECT : 0x022A,
	WM_QUERYDROPOBJECT : 0x022B,
	WM_BEGINDRAG : 0x022C,
	WM_DRAGLOOP : 0x022D,
	WM_DRAGSELECT : 0x022E,
	WM_DRAGMOVE : 0x022F,
	WM_MDISETMENU : 0x0230,
	WM_ENTERSIZEMOVE : 0x0231,
	WM_EXITSIZEMOVE : 0x0232,
	WM_DROPFILES : 0x0233,
	WM_MDIREFRESHMENU : 0x0234,
	WM_POINTERDEVICECHANGE : 0x0238,
	WM_POINTERDEVICEINRANGE : 0x0239,
	WM_POINTERDEVICEOUTOFRANGE : 0x023A,
	WM_TOUCH : 0x0240,
	WM_NCPOINTERUPDATE : 0x0241,
	WM_NCPOINTERDOWN : 0x0242,
	WM_NCPOINTERUP : 0x0243,
	WM_POINTERUPDATE : 0x0245,
	WM_POINTERDOWN : 0x0246,
	WM_POINTERUP : 0x0247,
	WM_POINTERENTER : 0x0249,
	WM_POINTERLEAVE : 0x024A,
	WM_POINTERACTIVATE : 0x024B,
	WM_POINTERCAPTURECHANGED : 0x024C,
	WM_TOUCHHITTESTING : 0x024D,
	WM_POINTERWHEEL : 0x024E,
	WM_POINTERHWHEEL : 0x024F,
	WM_IME_REPORT : 0x0280,
	WM_IME_SETCONTEXT : 0x0281,
	WM_IME_NOTIFY : 0x0282,
	WM_IME_CONTROL : 0x0283,
	WM_IME_COMPOSITIONFULL : 0x0284,
	WM_IME_SELECT : 0x0285,
	WM_IME_CHAR : 0x0286,
	WM_IME_REQUEST : 0x0288,
	WM_IME_KEYDOWN : 0x0290,
	WM_IME_KEYUP : 0x0291,
	WM_MOUSEHOVER : 0x02A1,
	WM_MOUSELEAVE : 0x02A3,
	WM_NCMOUSEHOVER : 0x02A0,
	WM_NCMOUSELEAVE : 0x02A2,
	WM_WTSSESSION_CHANGE : 0x02B1,
	WM_TABLET_ADDED : 0x02c8,
	WM_TABLET_DELETED : 0x02c9,
	WM_TABLET_FLICK : 0x02cb,
	WM_TABLET_QUERYSYSTEMGESTURESTATUS : 0x02cc,
	WM_CUT : 0x0300,
	WM_COPY : 0x0301,
	WM_PASTE : 0x0302,
	WM_CLEAR : 0x0303,
	WM_UNDO : 0x0304,
	WM_RENDERFORMAT : 0x0305,
	WM_RENDERALLFORMATS : 0x0306,
	WM_DESTROYCLIPBOARD : 0x0307,
	WM_DRAWCLIPBOARD : 0x0308,
	WM_PAINTCLIPBOARD : 0x0309,
	WM_VSCROLLCLIPBOARD : 0x030A,
	WM_SIZECLIPBOARD : 0x030B,
	WM_ASKCBFORMATNAME : 0x030C,
	WM_CHANGECBCHAIN : 0x030D,
	WM_HSCROLLCLIPBOARD : 0x030E,
	WM_QUERYNEWPALETTE : 0x030F,
	WM_PALETTEISCHANGING : 0x0310,
	WM_PALETTECHANGED : 0x0311,
	WM_HOTKEY : 0x0312,
	WM_PRINT : 0x0317,
	WM_PRINTCLIENT : 0x0318,
	WM_APPCOMMAND : 0x0319,
	WM_THEMECHANGED : 0x031A,
	WM_CLIPBOARDUPDATE : 0x031D,
	WM_DWMCOMPOSITIONCHANGED : 0x031E,
	WM_DWMNCRENDERINGCHANGED : 0x031F,
	WM_DWMCOLORIZATIONCOLORCHANGED : 0x0320,
	WM_DWMWINDOWMAXIMIZEDCHANGE : 0x0321,
	WM_GETTITLEBARINFOEX : 0x033F,
	WM_QUERYAFXWNDPROC : 0x0360,
	WM_SIZEPARENT : 0x0361,
	WM_SETMESSAGESTRING : 0x0362,
	WM_IDLEUPDATECMDUI : 0x0363,
	WM_INITIALUPDATE : 0x0364,
	WM_COMMANDHELP : 0x0365,
	WM_HELPHITTEST : 0x0366,
	WM_EXITHELPMODE : 0x0367,
	WM_RECALCPARENT : 0x0368,
	WM_SIZECHILD : 0x0369,
	WM_KICKIDLE : 0x036A,
	WM_QUERYCENTERWND : 0x036B,
	WM_DISABLEMODAL : 0x036C,
	WM_FLOATSTATUS : 0x036D,
	WM_ACTIVATETOPLEVEL : 0x036E,
	WM_QUERY3DCONTROLS : 0x036F,
	WM_SOCKET_NOTIFY : 0x0373,
	WM_SOCKET_DEAD : 0x0374,
	WM_POPMESSAGESTRING : 0x0375,
	WM_HELPPROMPTADDR : 0x0376,
	WM_QUEUE_SENTINEL : 0x0379,
	WM_RESERVED_037C : 0x037C,
	WM_RESERVED_037D : 0x037D,
	WM_RESERVED_037E : 0x037E,
	WM_FORWARDMSG : 0x037F,
	WM_USER : 0x0400,
	EM_GETSEL : 0x00B0,
	EM_SETSEL : 0x00B1,
	EM_GETRECT : 0x00B2,
	EM_SETRECT : 0x00B3,
	EM_SETRECTNP : 0x00B4,
	EM_SCROLL : 0x00B5,
	EM_LINESCROLL : 0x00B6,
	EM_SCROLLCARET : 0x00B7,
	EM_GETMODIFY : 0x00B8,
	EM_SETMODIFY : 0x00B9,
	EM_GETLINECOUNT : 0x00BA,
	EM_LINEINDEX : 0x00BB,
	EM_SETHANDLE : 0x00BC,
	EM_GETHANDLE : 0x00BD,
	EM_GETTHUMB : 0x00BE,
	EM_LINELENGTH : 0x00C1,
	EM_REPLACESEL : 0x00C2,
	EM_GETLINE : 0x00C4,
	EM_SETLIMITTEXT : 0x00C5,
	EM_CANUNDO : 0x00C6,
	EM_UNDO : 0x00C7,
	EM_FMTLINES : 0x00C8,
	EM_LINEFROMCHAR : 0x00C9,
	EM_SETTABSTOPS : 0x00CB,
	EM_SETPASSWORDCHAR : 0x00CC,
	EM_EMPTYUNDOBUFFER : 0x00CD,
	EM_GETFIRSTVISIBLELINE : 0x00CE,
	EM_SETREADONLY : 0x00CF,
	EM_SETWORDBREAKPROC : 0x00D0,
	EM_GETWORDBREAKPROC : 0x00D1,
	EM_GETPASSWORDCHAR : 0x00D2,
	EM_SETMARGINS : 0x00D3,
	EM_GETMARGINS : 0x00D4,
	EM_GETLIMITTEXT : 0x00D5,
	EM_POSFROMCHAR : 0x00D6,
	EM_CHARFROMPOS : 0x00D7,
	EM_SETIMESTATUS : 0x00D8,
	EM_GETIMESTATUS : 0x00D9,
	BM_GETCHECK : 0x00F0,
	BM_SETCHECK : 0x00F1,
	BM_GETSTATE : 0x00F2,
	BM_SETSTATE : 0x00F3,
	BM_SETSTYLE : 0x00F4,
	BM_CLICK : 0x00F5,
	BM_GETIMAGE : 0x00F6,
	BM_SETIMAGE : 0x00F7,
	BM_SETDONTCLICK : 0x00F8,
	CB_GETEDITSEL : 0x0140,
	CB_LIMITTEXT : 0x0141,
	CB_SETEDITSEL : 0x0142,
	CB_ADDSTRING : 0x0143,
	CB_DELETESTRING : 0x0144,
	CB_DIR : 0x0145,
	CB_GETCOUNT : 0x0146,
	CB_GETCURSEL : 0x0147,
	CB_GETLBTEXT : 0x0148,
	CB_GETLBTEXTLEN : 0x0149,
	CB_INSERTSTRING : 0x014A,
	CB_RESETCONTENT : 0x014B,
	CB_FINDSTRING : 0x014C,
	CB_SELECTSTRING : 0x014D,
	CB_SETCURSEL : 0x014E,
	CB_SHOWDROPDOWN : 0x014F,
	CB_GETITEMDATA : 0x0150,
	CB_SETITEMDATA : 0x0151,
	CB_GETDROPPEDCONTROLRECT : 0x0152,
	CB_SETITEMHEIGHT : 0x0153,
	CB_GETITEMHEIGHT : 0x0154,
	CB_SETEXTENDEDUI : 0x0155,
	CB_GETEXTENDEDUI : 0x0156,
	CB_GETDROPPEDSTATE : 0x0157,
	CB_FINDSTRINGEXACT : 0x0158,
	CB_SETLOCALE : 0x0159,
	CB_GETLOCALE : 0x015A,
	CB_GETTOPINDEX : 0x015b,
	CB_SETTOPINDEX : 0x015c,
	CB_GETHORIZONTALEXTENT : 0x015d,
	CB_SETHORIZONTALEXTENT : 0x015e,
	CB_GETDROPPEDWIDTH : 0x015f,
	CB_SETDROPPEDWIDTH : 0x0160,
	CB_INITSTORAGE : 0x0161,
	CB_MULTIPLEADDSTRING : 0x0163,
	CB_GETCOMBOBOXINFO : 0x0164,
	LB_ADDSTRING : 0x0180,
	LB_INSERTSTRING : 0x0181,
	LB_DELETESTRING : 0x0182,
	LB_SELITEMRANGEEX : 0x0183,
	LB_RESETCONTENT : 0x0184,
	LB_SETSEL : 0x0185,
	LB_SETCURSEL : 0x0186,
	LB_GETSEL : 0x0187,
	LB_GETCURSEL : 0x0188,
	LB_GETTEXT : 0x0189,
	LB_GETTEXTLEN : 0x018A,
	LB_GETCOUNT : 0x018B,
	LB_SELECTSTRING : 0x018C,
	LB_DIR : 0x018D,
	LB_GETTOPINDEX : 0x018E,
	LB_FINDSTRING : 0x018F,
	LB_GETSELCOUNT : 0x0190,
	LB_GETSELITEMS : 0x0191,
	LB_SETTABSTOPS : 0x0192,
	LB_GETHORIZONTALEXTENT : 0x0193,
	LB_SETHORIZONTALEXTENT : 0x0194,
	LB_SETCOLUMNWIDTH : 0x0195,
	LB_ADDFILE : 0x0196,
	LB_SETTOPINDEX : 0x0197,
	LB_GETITEMRECT : 0x0198,
	LB_GETITEMDATA : 0x0199,
	LB_SETITEMDATA : 0x019A,
	LB_SELITEMRANGE : 0x019B,
	LB_SETANCHORINDEX : 0x019C,
	LB_GETANCHORINDEX : 0x019D,
	LB_SETCARETINDEX : 0x019E,
	LB_GETCARETINDEX : 0x019F,
	LB_SETITEMHEIGHT : 0x01A0,
	LB_GETITEMHEIGHT : 0x01A1,
	LB_FINDSTRINGEXACT : 0x01A2,
	LB_CARETON : 0x01A3,
	LB_CARETOFF : 0x01A4,
	LB_SETLOCALE : 0x01A5,
	LB_GETLOCALE : 0x01A6,
	LB_SETCOUNT : 0x01A7,
	LB_INITSTORAGE : 0x01A8,
	LB_ITEMFROMPOINT : 0x01A9,
	LB_MULTIPLEADDSTRING : 0x01B1,
	LB_GETLISTBOXINFO : 0x01B2,
	SBM_SETPOS : 0x00E0,
	SBM_GETPOS : 0x00E1,
	SBM_SETRANGE : 0x00E2,
	SBM_GETRANGE : 0x00E3,
	SBM_ENABLE_ARROWS : 0x00E4,
	SBM_SETRANGEREDRAW : 0x00E6,
	SBM_SETSCROLLINFO : 0x00E9,
	SBM_GETSCROLLINFO : 0x00EA,
	SBM_GETSCROLLBARINFO : 0x00EB,
	STM_SETICON : 0x0170,
	STM_GETICON : 0x0171,
	STM_SETIMAGE : 0x0172,
	STM_GETIMAGE : 0x0173,
	WM_USER_1 : 0x0401,
	WM_USER_2 : 0x0402,
	WM_USER_3 : 0x0403,
	WM_USER_4 : 0x0404,
	WM_USER_5 : 0x0405,
	WM_USER_6 : 0x0406,
	WM_USER_7 : 0x0407,
	WM_USER_8 : 0x0408,
	WM_USER_9 : 0x0409,
	WM_USER_10 : 0x040a,
	WM_USER_11 : 0x040b,
	WM_USER_12 : 0x040c,
	WM_USER_13 : 0x040d,
	WM_USER_14 : 0x040e,
	WM_USER_15 : 0x040f,
	WM_USER_16 : 0x0410,
	WM_USER_17 : 0x0411,
	WM_USER_18 : 0x0412,
	WM_USER_19 : 0x0413,
	WM_USER_20 : 0x0414,
	WM_USER_21 : 0x0415,
	WM_USER_22 : 0x0416,
	WM_USER_23 : 0x0417,
	WM_USER_24 : 0x0418,
	WM_USER_25 : 0x0419,
	WM_USER_26 : 0x041a,
	WM_USER_27 : 0x041b,
	WM_USER_28 : 0x041c,
	WM_USER_29 : 0x041d,
	WM_USER_30 : 0x041e,
	WM_USER_31 : 0x041f,
	WM_USER_32 : 0x0420,
	WM_USER_33 : 0x0421,
	WM_USER_34 : 0x0422,
	WM_USER_35 : 0x0423,
	WM_USER_36 : 0x0424,
	WM_USER_37 : 0x0425,
	WM_USER_38 : 0x0426,
	WM_USER_39 : 0x0427,
	WM_USER_40 : 0x0428,
	WM_USER_41 : 0x0429,
	WM_USER_42 : 0x042a,
	WM_USER_43 : 0x042b,
	WM_USER_44 : 0x042c,
	WM_USER_45 : 0x042d,
	WM_USER_46 : 0x042e,
	WM_USER_47 : 0x042f,
	WM_USER_48 : 0x0430,
	WM_USER_49 : 0x0431,
	WM_USER_50 : 0x0432,
	WM_USER_51 : 0x0433,
	WM_USER_52 : 0x0434,
	WM_USER_53 : 0x0435,
	WM_USER_54 : 0x0436,
	WM_USER_55 : 0x0437,
	WM_USER_56 : 0x0438,
	WM_USER_57 : 0x0439,
	WM_USER_58 : 0x043a,
	WM_USER_59 : 0x043b,
	WM_USER_60 : 0x043c,
	WM_USER_61 : 0x043d,
	WM_USER_62 : 0x043e,
	WM_USER_63 : 0x043f,
	WM_USER_64 : 0x0440,
	WM_USER_65 : 0x0441,
	WM_USER_66 : 0x0442,
	WM_USER_67 : 0x0443,
	WM_USER_68 : 0x0444,
	WM_USER_69 : 0x0445,
	WM_USER_70 : 0x0446,
	WM_USER_71 : 0x0447,
	WM_USER_72 : 0x0448,
	WM_USER_73 : 0x0449,
	WM_USER_74 : 0x044a,
	WM_USER_75 : 0x044b,
	WM_USER_76 : 0x044c,
	WM_USER_77 : 0x044d,
	WM_USER_78 : 0x044e,
	WM_USER_79 : 0x044f,
	WM_USER_80 : 0x0450,
	WM_USER_81 : 0x0451,
	WM_USER_82 : 0x0452,
	WM_USER_83 : 0x0453,
	WM_USER_84 : 0x0454,
	WM_USER_85 : 0x0455,
	WM_USER_86 : 0x0456,
	WM_USER_87 : 0x0457,
	WM_USER_88 : 0x0458,
	WM_USER_89 : 0x0459,
	WM_USER_90 : 0x045a,
	WM_USER_91 : 0x045b,
	WM_USER_92 : 0x045c,
	WM_USER_93 : 0x045d,
	WM_USER_94 : 0x045e,
	WM_USER_95 : 0x045f,
	WM_USER_96 : 0x0460,
	WM_USER_97 : 0x0461,
	WM_USER_98 : 0x0462,
	WM_USER_99 : 0x0463,
	WM_USER_100 : 0x0464,
	LVM_GETBKCOLOR : 0x00001000,
	LVM_SETBKCOLOR : 0x00001001,
	LVM_GETIMAGELIST : 0x00001002,
	LVM_SETIMAGELIST : 0x00001003,
	LVM_GETITEMCOUNT : 0x00001004,
	LVM_GETITEMA : 0x00001005,
	LVM_GETITEMW : 0x0000104b,
	LVM_SETITEMA : 0x00001006,
	LVM_SETITEMW : 0x0000104c,
	LVM_INSERTITEMA : 0x00001007,
	LVM_INSERTITEMW : 0x0000104d,
	LVM_DELETEITEM : 0x00001008,
	LVM_DELETEALLITEMS : 0x00001009,
	LVM_GETCALLBACKMASK : 0x0000100a,
	LVM_SETCALLBACKMASK : 0x0000100b,
	LVM_GETNEXTITEM : 0x0000100c,
	LVM_FINDITEMA : 0x0000100d,
	LVM_FINDITEMW : 0x00001053,
	LVM_GETITEMRECT : 0x0000100e,
	LVM_SETITEMPOSITION : 0x0000100f,
	LVM_GETITEMPOSITION : 0x00001010,
	LVM_GETSTRINGWIDTHA : 0x00001011,
	LVM_GETSTRINGWIDTHW : 0x00001057,
	LVM_HITTEST : 0x00001012,
	LVM_ENSUREVISIBLE : 0x00001013,
	LVM_SCROLL : 0x00001014,
	LVM_REDRAWITEMS : 0x00001015,
	LVM_ARRANGE : 0x00001016,
	LVM_EDITLABELA : 0x00001017,
	LVM_EDITLABELW : 0x00001076,
	LVM_GETEDITCONTROL : 0x00001018,
	LVM_GETCOLUMNA : 0x00001019,
	LVM_GETCOLUMNW : 0x0000105f,
	LVM_SETCOLUMNA : 0x0000101a,
	LVM_SETCOLUMNW : 0x00001060,
	LVM_INSERTCOLUMNA : 0x0000101b,
	LVM_INSERTCOLUMNW : 0x00001061,
	LVM_DELETECOLUMN : 0x0000101c,
	LVM_GETCOLUMNWIDTH : 0x0000101d,
	LVM_SETCOLUMNWIDTH : 0x0000101e,
	LVM_GETHEADER : 0x0000101f,
	LVM_CREATEDRAGIMAGE : 0x00001021,
	LVM_GETVIEWRECT : 0x00001022,
	LVM_GETTEXTCOLOR : 0x00001023,
	LVM_SETTEXTCOLOR : 0x00001024,
	LVM_GETTEXTBKCOLOR : 0x00001025,
	LVM_SETTEXTBKCOLOR : 0x00001026,
	LVM_GETTOPINDEX : 0x00001027,
	LVM_GETCOUNTPERPAGE : 0x00001028,
	LVM_GETORIGIN : 0x00001029,
	LVM_UPDATE : 0x0000102a,
	LVM_SETITEMSTATE : 0x0000102b,
	LVM_GETITEMSTATE : 0x0000102c,
	LVM_GETITEMTEXTA : 0x0000102d,
	LVM_GETITEMTEXTW : 0x00001073,
	LVM_SETITEMTEXTA : 0x0000102e,
	LVM_SETITEMTEXTW : 0x00001074,
	LVM_SETITEMCOUNT : 0x0000102f,
	LVM_SORTITEMS : 0x00001030,
	LVM_SETITEMPOSITION32 : 0x00001031,
	LVM_GETSELECTEDCOUNT : 0x00001032,
	LVM_GETITEMSPACING : 0x00001033,
	LVM_GETISEARCHSTRINGA : 0x00001034,
	LVM_GETISEARCHSTRINGW : 0x00001075,
	LVM_SETICONSPACING : 0x00001035,
	LVM_SETEXTENDEDLISTVIEWSTYLE : 0x00001036,
	LVM_GETEXTENDEDLISTVIEWSTYLE : 0x00001037,
	LVM_GETSUBITEMRECT : 0x00001038,
	LVM_SUBITEMHITTEST : 0x00001039,
	LVM_SETCOLUMNORDERARRAY : 0x0000103a,
	LVM_GETCOLUMNORDERARRAY : 0x0000103b,
	LVM_SETHOTITEM : 0x0000103c,
	LVM_GETHOTITEM : 0x0000103d,
	LVM_SETHOTCURSOR : 0x0000103e,
	LVM_GETHOTCURSOR : 0x0000103f,
	LVM_APPROXIMATEVIEWRECT : 0x00001040,
	LVM_SETWORKAREAS : 0x00001041,
	LVM_GETWORKAREAS : 0x00001046,
	LVM_GETNUMBEROFWORKAREAS : 0x00001049,
	LVM_GETSELECTIONMARK : 0x00001042,
	LVM_SETSELECTIONMARK : 0x00001043,
	LVM_SETHOVERTIME : 0x00001047,
	LVM_GETHOVERTIME : 0x00001048,
	LVM_SETTOOLTIPS : 0x0000104a,
	LVM_GETTOOLTIPS : 0x0000104e,
	LVM_SORTITEMSEX : 0x00001051,
	LVM_SETBKIMAGEA : 0x00001044,
	LVM_SETBKIMAGEW : 0x0000108a,
	LVM_GETBKIMAGEA : 0x00001045,
	LVM_GETBKIMAGEW : 0x0000108b,
	LVM_SETSELECTEDCOLUMN : 0x0000108c,
	LVM_SETVIEW : 0x0000108e,
	LVM_GETVIEW : 0x0000108f,
	LVM_INSERTGROUP : 0x00001091,
	LVM_SETGROUPINFO : 0x00001093,
	LVM_GETGROUPINFO : 0x00001095,
	LVM_REMOVEGROUP : 0x00001096,
	LVM_MOVEGROUP : 0x00001097,
	LVM_GETGROUPCOUNT : 0x00001098,
	LVM_GETGROUPINFOBYINDEX : 0x00001099,
	LVM_MOVEITEMTOGROUP : 0x0000109a,
	LVM_GETGROUPRECT : 0x00001062,
	LVM_SETGROUPMETRICS : 0x0000109b,
	LVM_GETGROUPMETRICS : 0x0000109c,
	LVM_ENABLEGROUPVIEW : 0x0000109d,
	LVM_SORTGROUPS : 0x0000109e,
	LVM_INSERTGROUPSORTED : 0x0000109f,
	LVM_REMOVEALLGROUPS : 0x000010a0,
	LVM_HASGROUP : 0x000010a1,
	LVM_GETGROUPSTATE : 0x0000105c,
	LVM_GETFOCUSEDGROUP : 0x0000105d,
	LVM_SETTILEVIEWINFO : 0x000010a2,
	LVM_GETTILEVIEWINFO : 0x000010a3,
	LVM_SETTILEINFO : 0x000010a4,
	LVM_GETTILEINFO : 0x000010a5,
	LVM_SETINSERTMARK : 0x000010a6,
	LVM_GETINSERTMARK : 0x000010a7,
	LVM_INSERTMARKHITTEST : 0x000010a8,
	LVM_GETINSERTMARKRECT : 0x000010a9,
	LVM_SETINSERTMARKCOLOR : 0x000010aa,
	LVM_GETINSERTMARKCOLOR : 0x000010ab,
	LVM_SETINFOTIP : 0x000010ad,
	LVM_GETSELECTEDCOLUMN : 0x000010ae,
	LVM_ISGROUPVIEWENABLED : 0x000010af,
	LVM_GETOUTLINECOLOR : 0x000010b0,
	LVM_SETOUTLINECOLOR : 0x000010b1,
	LVM_CANCELEDITLABEL : 0x000010b3,
	LVM_MAPINDEXTOID : 0x000010b4,
	LVM_MAPIDTOINDEX : 0x000010b5,
	LVM_ISITEMVISIBLE : 0x000010b6,
	LVM_GETEMPTYTEXT : 0x000010cc,
	LVM_GETFOOTERRECT : 0x000010cd,
	LVM_GETFOOTERINFO : 0x000010ce,
	LVM_GETFOOTERITEMRECT : 0x000010cf,
	LVM_GETFOOTERITEM : 0x000010d0,
	LVM_GETITEMINDEXRECT : 0x000010d1,
	LVM_SETITEMINDEXSTATE : 0x000010d2,
	LVM_GETNEXTITEMINDEX : 0x000010d3,
	TVM_INSERTITEMA : 0x00001100,
	TVM_INSERTITEMW : 0x00001132,
	TVM_DELETEITEM : 0x00001101,
	TVM_EXPAND : 0x00001102,
	TVM_GETITEMRECT : 0x00001104,
	TVM_GETCOUNT : 0x00001105,
	TVM_GETINDENT : 0x00001106,
	TVM_SETINDENT : 0x00001107,
	TVM_GETIMAGELIST : 0x00001108,
	TVM_SETIMAGELIST : 0x00001109,
	TVM_GETNEXTITEM : 0x0000110a,
	TVM_SELECTITEM : 0x0000110b,
	TVM_GETITEMA : 0x0000110c,
	TVM_GETITEMW : 0x0000113e,
	TVM_SETITEMA : 0x0000110d,
	TVM_SETITEMW : 0x0000113f,
	TVM_EDITLABELA : 0x0000110e,
	TVM_EDITLABELW : 0x00001141,
	TVM_GETEDITCONTROL : 0x0000110f,
	TVM_GETVISIBLECOUNT : 0x00001110,
	TVM_HITTEST : 0x00001111,
	TVM_CREATEDRAGIMAGE : 0x00001112,
	TVM_SORTCHILDREN : 0x00001113,
	TVM_ENSUREVISIBLE : 0x00001114,
	TVM_SORTCHILDRENCB : 0x00001115,
	TVM_ENDEDITLABELNOW : 0x00001116,
	TVM_GETISEARCHSTRINGA : 0x00001117,
	TVM_GETISEARCHSTRINGW : 0x00001140,
	TVM_SETTOOLTIPS : 0x00001118,
	TVM_GETTOOLTIPS : 0x00001119,
	TVM_SETINSERTMARK : 0x0000111a,
	TVM_SETITEMHEIGHT : 0x0000111b,
	TVM_GETITEMHEIGHT : 0x0000111c,
	TVM_SETBKCOLOR : 0x0000111d,
	TVM_SETTEXTCOLOR : 0x0000111e,
	TVM_GETBKCOLOR : 0x0000111f,
	TVM_GETTEXTCOLOR : 0x00001120,
	TVM_SETSCROLLTIME : 0x00001121,
	TVM_GETSCROLLTIME : 0x00001122,
	TVM_SETINSERTMARKCOLOR : 0x00001125,
	TVM_GETINSERTMARKCOLOR : 0x00001126,
	TVM_GETITEMSTATE : 0x00001127,
	TVM_SETLINECOLOR : 0x00001128,
	TVM_GETLINECOLOR : 0x00001129,
	TVM_MAPACCIDTOHTREEITEM : 0x0000112a,
	TVM_MAPHTREEITEMTOACCID : 0x0000112b,
	TVM_SETEXTENDEDSTYLE : 0x0000112c,
	TVM_GETEXTENDEDSTYLE : 0x0000112d,
	TVM_SETAUTOSCROLLINFO : 0x0000113b,
	TVM_GETSELECTEDCOUNT : 0x00001146,
	TVM_SHOWINFOTIP : 0x00001147,
	TVM_GETITEMPARTRECT : 0x00001148,
	HDM_GETITEMCOUNT : 0x00001200,
	HDM_INSERTITEMA : 0x00001201,
	HDM_INSERTITEMW : 0x0000120a,
	HDM_DELETEITEM : 0x00001202,
	HDM_GETITEMA : 0x00001203,
	HDM_GETITEMW : 0x0000120b,
	HDM_SETITEMA : 0x00001204,
	HDM_SETITEMW : 0x0000120c,
	HDM_LAYOUT : 0x00001205,
	HDM_HITTEST : 0x00001206,
	HDM_GETITEMRECT : 0x00001207,
	HDM_SETIMAGELIST : 0x00001208,
	HDM_GETIMAGELIST : 0x00001209,
	HDM_ORDERTOINDEX : 0x0000120f,
	HDM_CREATEDRAGIMAGE : 0x00001210,
	HDM_GETORDERARRAY : 0x00001211,
	HDM_SETORDERARRAY : 0x00001212,
	HDM_SETHOTDIVIDER : 0x00001213,
	HDM_SETBITMAPMARGIN : 0x00001214,
	HDM_GETBITMAPMARGIN : 0x00001215,
	HDM_SETFILTERCHANGETIMEOUT : 0x00001216,
	HDM_EDITFILTER : 0x00001217,
	HDM_CLEARFILTER : 0x00001218,
	HDM_GETITEMDROPDOWNRECT : 0x00001219,
	HDM_GETOVERFLOWRECT : 0x0000121a,
	HDM_GETFOCUSEDITEM : 0x0000121b,
	HDM_SETFOCUSEDITEM : 0x0000121c,
	TCM_GETIMAGELIST : 0x00001302,
	TCM_SETIMAGELIST : 0x00001303,
	TCM_GETITEMCOUNT : 0x00001304,
	TCM_GETITEMA : 0x00001305,
	TCM_GETITEMW : 0x0000133c,
	TCM_SETITEMA : 0x00001306,
	TCM_SETITEMW : 0x0000133d,
	TCM_INSERTITEMA : 0x00001307,
	TCM_INSERTITEMW : 0x0000133e,
	TCM_DELETEITEM : 0x00001308,
	TCM_DELETEALLITEMS : 0x00001309,
	TCM_GETITEMRECT : 0x0000130a,
	TCM_GETCURSEL : 0x0000130b,
	TCM_SETCURSEL : 0x0000130c,
	TCM_HITTEST : 0x0000130d,
	TCM_SETITEMEXTRA : 0x0000130e,
	TCM_ADJUSTRECT : 0x00001328,
	TCM_SETITEMSIZE : 0x00001329,
	TCM_REMOVEIMAGE : 0x0000132a,
	TCM_SETPADDING : 0x0000132b,
	TCM_GETROWCOUNT : 0x0000132c,
	TCM_GETTOOLTIPS : 0x0000132d,
	TCM_SETTOOLTIPS : 0x0000132e,
	TCM_GETCURFOCUS : 0x0000132f,
	TCM_SETCURFOCUS : 0x00001330,
	TCM_SETMINTABWIDTH : 0x00001331,
	TCM_DESELECTALL : 0x00001332,
	TCM_HIGHLIGHTITEM : 0x00001333,
	TCM_SETEXTENDEDSTYLE : 0x00001334,
	TCM_GETEXTENDEDSTYLE : 0x00001335,
	PGM_SETCHILD : 0x00001401,
	PGM_RECALCSIZE : 0x00001402,
	PGM_FORWARDMOUSE : 0x00001403,
	PGM_SETBKCOLOR : 0x00001404,
	PGM_GETBKCOLOR : 0x00001405,
	PGM_SETBORDER : 0x00001406,
	PGM_GETBORDER : 0x00001407,
	PGM_SETPOS : 0x00001408,
	PGM_GETPOS : 0x00001409,
	PGM_SETBUTTONSIZE : 0x0000140a,
	PGM_GETBUTTONSIZE : 0x0000140b,
	PGM_GETBUTTONSTATE : 0x0000140c,
	EM_SETCUEBANNER : 0x00001501,
	EM_GETCUEBANNER : 0x00001502,
	EM_SHOWBALLOONTIP : 0x00001503,
	EM_HIDEBALLOONTIP : 0x00001504,
	EM_SETHILITE : 0x00001505,
	EM_GETHILITE : 0x00001506,
	BCM_GETIDEALSIZE : 0x00001601,
	BCM_SETIMAGELIST : 0x00001602,
	BCM_GETIMAGELIST : 0x00001603,
	BCM_SETTEXTMARGIN : 0x00001604,
	BCM_GETTEXTMARGIN : 0x00001605,
	BCM_SETDROPDOWNSTATE : 0x00001606,
	BCM_SETSPLITINFO : 0x00001607,
	BCM_GETSPLITINFO : 0x00001608,
	BCM_SETNOTE : 0x00001609,
	BCM_GETNOTE : 0x0000160a,
	BCM_GETNOTELENGTH : 0x0000160b,
	BCM_SETSHIELD : 0x0000160c,
	CB_SETMINVISIBLE : 0x00001701,
	CB_GETMINVISIBLE : 0x00001702,
	CB_SETCUEBANNER : 0x00001703,
	CB_GETCUEBANNER : 0x00001704,
	CCM_SETBKCOLOR : 0x00002001,
	CCM_SETCOLORSCHEME : 0x00002002,
	CCM_GETCOLORSCHEME : 0x00002003,
	CCM_GETDROPTARGET : 0x00002004,
	CCM_SETUNICODEFORMAT : 0x00002005,
	CCM_GETUNICODEFORMAT : 0x00002006,
	CCM_SETVERSION : 0x00002007,
	CCM_GETVERSION : 0x00002008,
	CCM_SETNOTIFYWINDOW : 0x00002009,
	CCM_SETWINDOWTHEME : 0x0000200b,
	CCM_DPISCALE : 0x0000200c,
	WM_RASDIALEVENT : 0x0000cccd
}

// Helpers
//-----------------------
var EnumMsgName = Object.keys(msgType).reduce(function (acc, key) {
	return acc[msgType[key]] = key, acc;
}, {});

function msToTime(s) {
	function pad(n, z) {
	  return ('00' + n).slice(-z);
	}
	
	var ms = s % 1000;
	s = (s - ms) / 1000;
	var secs = s % 60;
	s = (s - secs) / 60;
	var mins = s % 60;
	var hrs = (s - mins) / 60;
	
	return pad(hrs, 2) + ':' + pad(mins, 2) + ':' + pad(secs, 2) + '.' + pad(ms, 3);
}

function wndClassFromHandle(hWND) {
    var lpString = Memory.alloc(0xff);
    var callRes = fGetClassNameW(hWND, lpString, 0xff);
    if (callRes == 0) {
        return "UNKNOWN";
    } else {
        return lpString.readUtf16String();
    }
}

// Hooks
//-----------------------
Interceptor.attach(pTranslateMessage, {
	onEnter: function (args) {
        send("\n[+] Called user32!TranslateMessage");

        // An odd layout in memory
        // no padding after TIME on x64
        //-----
        // typedef struct tagMSG {
        //   HWND   hwnd;
        //   UINT   message;
        //   WPARAM wParam;
        //   LPARAM lParam;
        //   DWORD  time;
        //   POINT  pt;
        //   DWORD  lPrivate;
        // } MSG, *PMSG, *NPMSG, *LPMSG;
		var tagMSG = args[0];
        send("    |_ hwnd     : " + tagMSG.readPointer());
        send("    |_ wndClass : " + wndClassFromHandle(tagMSG.readPointer()));
        send("    |_ message  : " + EnumMsgName[(tagMSG.add(8)).readU32()]);
        send("    |_ wParam   : " + (tagMSG.add(8*2)).readPointer());
        send("    |_ lParam   : " + (tagMSG.add(8*3)).readPointer());
        send("    |_ uptime   : " + msToTime((tagMSG.add(8*4)).readU32()));
        var pX = (tagMSG.add(8*4 + 4)).readU32();
        var pY = (tagMSG.add(8*4 + 8)).readU32();
        send("    |_ point    : " + pX + "x" + pY);
	}
});